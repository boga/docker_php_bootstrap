# Dockerfile path is relative to build directory
nginx:
 dockerfile: ./Dockerfile
 build: ./contaners/nginx
 ports:
  - 8080:80
 volumes:
  - ./logs:/etc/logs/nginx
 volumes_from:
  - fpm:rw
 environment:
  - NGINX_HOST=localhost
  - NGINX_PORT=80
 command: nginx -g "daemon off;"
 links:
  - fpm

fpm:
 dockerfile: ./Dockerfile
 build: ./contaners/fpm
 ports:
 - 8083:9000
 environment:
  XDEBUG_CONFIG: "default_enable=0 remote_enable=1 remote_autostart=0
    remote_connect_back=0 idekey=IDEAKEY remote_host=192.168.1.3
    profiler_enable=0 profiler_output_dir=/xdebug/profiler
    profiler_output_name=cachegrind.out.%u.%p
  "
 volumes:
  - ./php-code:/var/www/html:rw
  - ./logs/xdebug_profiler:/xdebug/profiler:rw
 links:
  - db

db:
 # Original MySQL image can't work properly on Win10 because of this bug: https://github.com/docker-library/percona/issues/42
 image: bitnami/mariadb
 ports:
  - 8082:3306
 volumes:
  - ./database/mariadb:/bitnami
 environment:
  - MARIADB_DATABASE=docker
  - MARIADB_USER=docker
  - MARIADB_PASSWORD=docker
  - MARIADB_ROOT_PASSWORD=example

adminer:
 image: adminer
 ports:
  - 8081:8080
 links:
  - db
